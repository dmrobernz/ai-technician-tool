
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Technician Tool (Cloud Sync)</title>
  <link rel="manifest" href="manifest.json" />
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
  <script src="firebaseConfig.js"></script>
  
    <style>
      * { box-sizing: border-box; }
      table { width: 100%; border-collapse: collapse; display: block; overflow-x: auto; }
      th, td { padding: 8px; border: 1px solid #ccc; text-align: left; min-width: 120px; }
      @media (max-width: 768px) {
        body { margin: 10px; }
        h1 { font-size: 22px; }
        label { font-size: 14px; }
        input, textarea { font-size: 14px; }
        button { font-size: 14px; padding: 8px 12px; }
        th, td { font-size: 13px; }
      }

    body { font-family: Arial, sans-serif; margin: 30px; background: #f4f4f4; }
    h1, h2 { color: #2e6c80; }
    .section { background: white; padding: 20px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    label { font-weight: bold; display: block; margin-top: 10px; }
    input, textarea { width: 100%; padding: 8px; margin-top: 5px; border-radius: 4px; border: 1px solid #ccc; }
    button { margin-top: 15px; padding: 10px 20px; background-color: #2e6c80; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background-color: #244f66; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
  </style>
</head>
<body>
  <h1>AI Technician Tool (Cloud Sync)</h1>

  <div class="section">
    <h2>Record Entry</h2>
    <form id="aiForm">
      <input type="hidden" id="docId" />
      <label>Date:</label><input type="date" id="date" />
      <label>Farm:</label><input type="text" id="farm" />
      <label>Cow ID:</label><input type="text" id="cowId" />
      <label>Breed:</label><input type="text" id="breed" />
      <label>Semen Straw Used:</label><input type="text" id="semen" />
      <label>Method:</label><input type="text" id="method" />
      <label>Heat Signs Observed:</label><input type="text" id="heatSigns" />
      <label>Technician Notes:</label><textarea rows="3" id="notes"></textarea>
      <button type="button" onclick="saveRecord()">Save Record</button>
    </form>
  </div>

  <div class="section">
    <h2>Saved Records (Firestore)</h2>
    <table id="recordTable">
      <thead>
        <tr><th>Date</th><th>Farm</th><th>Cow ID</th><th>Breed</th><th>Semen</th><th>Method</th><th>Heat</th><th>Notes</th><th>Actions</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const db = firebase.firestore();
    const recordsRef = db.collection("records");

    function saveRecord() {
      const docId = document.getElementById("docId").value;
      const data = {
        date: document.getElementById("date").value,
        farm: document.getElementById("farm").value,
        cowId: document.getElementById("cowId").value,
        breed: document.getElementById("breed").value,
        semen: document.getElementById("semen").value,
        method: document.getElementById("method").value,
        heatSigns: document.getElementById("heatSigns").value,
        notes: document.getElementById("notes").value,
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      };

      if (docId) {
        recordsRef.doc(docId).set(data).then(() => {
          document.getElementById("aiForm").reset();
          displayRecords();
        });
      } else {
        recordsRef.add(data).then(() => {
          document.getElementById("aiForm").reset();
          displayRecords();
        });
      }
    }

    function displayRecords() {
      recordsRef.orderBy("timestamp", "desc").onSnapshot(snapshot => {
        const tbody = document.querySelector("#recordTable tbody");
        tbody.innerHTML = "";
        snapshot.forEach(doc => {
          const r = doc.data();
          const row = tbody.insertRow();
          row.innerHTML = `
            <td>${r.date || ""}</td><td>${r.farm || ""}</td><td>${r.cowId || ""}</td><td>${r.breed || ""}</td>
            <td>${r.semen || ""}</td><td>${r.method || ""}</td><td>${r.heatSigns || ""}</td><td>${r.notes || ""}</td>
            <td>
              <button onclick="editRecord('${doc.id}')">Edit</button>
              <button onclick="deleteRecord('${doc.id}')">Delete</button>
            </td>`;
        });
      });
    }

    function editRecord(id) {
      recordsRef.doc(id).get().then(doc => {
        if (doc.exists) {
          const r = doc.data();
          document.getElementById("docId").value = id;
          document.getElementById("date").value = r.date;
          document.getElementById("farm").value = r.farm;
          document.getElementById("cowId").value = r.cowId;
          document.getElementById("breed").value = r.breed;
          document.getElementById("semen").value = r.semen;
          document.getElementById("method").value = r.method;
          document.getElementById("heatSigns").value = r.heatSigns;
          document.getElementById("notes").value = r.notes;
        }
      });
    }

    function deleteRecord(id) {
      if (confirm("Delete this record?")) {
        recordsRef.doc(id).delete();
      }
    }

    displayRecords();
  </script>
</body>
</html>
